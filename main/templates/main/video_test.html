{% extends "main/base_main.html" %}

{% block content %}
    <div id="container">
        <video playsinline id="videoElement"></video>
        <canvas id="canvas"  width="400" height="300"></canvas>
        <br>
        <h2></h2>
        <h2 id="rslt">DETECT ME</h2>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');
        const video = document.querySelector("#videoElement");

        video.width = 400;
        video.height = 300;

        if (navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices
                .getUserMedia({ video: true })
                .then(function (stream) {
                    video.srcObject = stream;
                    video.play();
                })
                .catch(function (errMsg) {
                    console.log(errMsg)
                });
        }
        const FPS = 2;

        function ajaxTest(){
            context.drawImage(video, 0, 0, video.width, video.height);
            var data = canvas.toDataURL('image/png', 1.0);
            context.clearRect(0, 0, video.width, video.height);

            $.ajax({
                type : "POST",
                url : "/detectme",
                data : {data:data},
                success : function(result) {
                    $('#rslt').text('User Status: ' + result['userState']);
                    console.log(result);
                },
                error : function() {
                    console.log('통신 실패');
                },

            });
        }
        playAlert = setInterval(function() {
            ajaxTest();
        }, 10000);//1000 / FPS);

    </script>

{% endblock %}